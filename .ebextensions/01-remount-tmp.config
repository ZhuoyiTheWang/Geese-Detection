files:
  "/usr/local/bin/remount-tmp.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Remount /tmp with a 10GB size limit
      mount -o remount,size=10G /tmp

  "/etc/systemd/system/remount-tmp.service":
    mode: "000644"
    owner: root
    group: root
    content: |
      [Unit]
      Description=Remount /tmp with a larger size
      After=local-fs.target

      [Service]
      Type=oneshot
      ExecStart=/usr/local/bin/remount-tmp.sh
      RemainAfterExit=yes

      [Install]
      WantedBy=multi-user.target

commands:
  reload_systemd:
    command: "systemctl daemon-reload"
  enable_remount_service:
    command: "systemctl enable remount-tmp.service"
